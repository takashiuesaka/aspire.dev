---
import { Image } from "astro:assets";

import adminerIcon from "@assets/icons/adminer-icon.png";
import activeMqIcon from "@assets/icons/activemq-icon.png";
import activeMqLightIcon from "@assets/icons/activemq-light-icon.png";
import awsIcon from "@assets/icons/aws-icon.png";
import awsLightIcon from "@assets/icons/aws-light-icon.png";
import azureAppServicesIcon from "@assets/icons/azure-app-services.svg";
import azureContainerAppsEnvironmentsIcon from "@assets/icons/azure-container-apps-environments.svg";
import azureAiFoundryIcon from "@assets/icons/azure-ai-foundry-icon.png";
import azureAppconfigIcon from "@assets/icons/azure-appconfig-icon.png";
import azureAppinsightsIcon from "@assets/icons/azure-appinsights-icon.png";
import azureBlobpagestorageIcon from "@assets/icons/azure-blobpagestorage-icon.png";
import azureCacheredisIcon from "@assets/icons/azure-cacheredis-icon.png";
import azureCosmosdbIcon from "@assets/icons/azure-cosmosdb-icon.png";
import azureEventhubsIcon from "@assets/icons/azure-eventhubs-icon.png";
import azureFunctionappsIcon from "@assets/icons/azure-functionapps-icon.png";
import azureIcon from "@assets/icons/azure-icon.png";
import azureKeyvaultIcon from "@assets/icons/azure-keyvault-icon.png";
import azureLoganalyticsIcon from "@assets/icons/azure-loganalytics-icon.png";
import azureOpenaiIcon from "@assets/icons/azure-openai-icon.png";
import azurePostgresqlIcon from "@assets/icons/azure-postgresql-icon.png";
import azureSearchIcon from "@assets/icons/azure-search-icon.png";
import azureServicebusIcon from "@assets/icons/azure-servicebus-icon.png";
import azureSignalrIcon from "@assets/icons/azure-signalr-icon.png";
import azureSqlserverIcon from "@assets/icons/azure-sqlserver-icon.png";
import azureStoragecontainerIcon from "@assets/icons/azure-storagecontainer-icon.png";
import azureStoragequeueIcon from "@assets/icons/azure-storagequeue-icon.png";
import azureTableIcon from "@assets/icons/azure-table-icon.png";
import azureWebpubsubIcon from "@assets/icons/azure-webpubsub-icon.png";
import bunIcon from "@assets/icons/bun-icon.png";
import dataApiBuilderIcon from "@assets/icons/data-api-builder-icon.png";
import daprIcon from "@assets/icons/dapr-icon.png";
import daprLightIcon from "@assets/icons/dapr-light-icon.png";
import dbGateIcon from "@assets/icons/dbgate-icon.svg";
import dbGateLightIcon from "@assets/icons/dbgate-light-icon.svg";
import denoIcon from "@assets/icons/deno-icon.png";
import denoLightIcon from "@assets/icons/deno-light-icon.png";
import devTunnelsIcon from "@assets/icons/dev-tunnels-icon.svg";
import dockerIcon from "@assets/icons/docker.svg";
import elasticIcon from "@assets/icons/elastic-icon.png";
import flagDIcon from "@assets/icons/flagd-icon.svg";
import flagDLightIcon from "@assets/icons/flagd-light-icon.svg";
import garnetIcon from "@assets/icons/garnet-icon.png";
import goIcon from "@assets/icons/go-icon.png";
import goLightIcon from "@assets/icons/go-light-icon.png";
import gitHubIcon from "@assets/icons/github-icon.png";
import gitHubLightIcon from "@assets/icons/github-light-icon.png";
import javaIcon from "@assets/icons/java-icon.png";
import javascriptIcon from "@assets/icons/javascript.svg";
import k6Icon from "@assets/icons/k6-icon.png";
import keycloakIcon from "@assets/icons/keycloak-icon.svg";
import kubernetesIcon from "@assets/icons/kubernetes.svg";
import kurrentDbIcon from "@assets/icons/kurrent-icon.png";
import kurrentDbLightIcon from "@assets/icons/kurrent-light-icon.png";
import fastApiIcon from "@assets/icons/fastapi-icon.svg";
import lavinMqIcon from "@assets/icons/lavinmq-icon.png";
import mailpitIcon from "@assets/icons/mailpit-icon.svg";
import mailpitLightIcon from "@assets/icons/mailpit-light-icon.svg";
import mauiIcon from "@assets/icons/maui-icon.png";
import meilisearchIcon from "@assets/icons/meilisearch-icon.png";
import mcpInspectorIcon from "@assets/icons/mcp-inspector-icon.png";
import mcpInspectorLightIcon from "@assets/icons/mcp-inspector-light-icon.png";
import milvusIcon from "@assets/icons/milvus-icon.png";
import minioIcon from "@assets/icons/minio-icon.png";
import mongodbIcon from "@assets/icons/mongodb-icon.png";
import mysqlconnectorIcon from "@assets/icons/mysqlconnector-icon.png";
import natsIcon from "@assets/icons/nats-icon.png";
import ngrokIcon from "@assets/icons/ngrok-icon.png";
import ngrokLightIcon from "@assets/icons/ngrok-light-icon.png";
import nodeJsIcon from "@assets/icons/nodejs-icon.png";
import nodeJsLightIcon from "@assets/icons/nodejs-light-icon.png";
import ollamaIcon from "@assets/icons/ollama-icon.png";
import oracleIcon from "@assets/icons/oracle-icon.svg";
import openAiIcon from "@assets/icons/openai-icon.png";
import openAiLightIcon from "@assets/icons/openai-light-icon.png";
import papercutIcon from "@assets/icons/papercut-icon.png";
import papercutLightIcon from "@assets/icons/papercut-light-icon.png";
import postgresqlIcon from "@assets/icons/postgresql-icon.png";
import powershellIcon from "@assets/icons/powershell-icon.png";
import pythonIcon from "@assets/icons/python.svg";
import qdrantIcon from "@assets/icons/qdrant-icon.png";
import rabbitmqIcon from "@assets/icons/rabbitmq-icon.svg";
import ravenDbIcon from "@assets/icons/ravendb-icon.png";
import ravenDbLightIcon from "@assets/icons/ravendb-light-icon.png";
import reactIcon from "@assets/icons/react-icon.svg";
import redisIcon from "@assets/icons/redis-icon.png";
import rustIcon from "@assets/icons/rust-icon.png";
import seqIcon from "@assets/icons/seq-icon.png";
import sqlDatabaseProjectsIcon from "@assets/icons/sql-database-projects-icon.png";
import surrealDbIcon from "@assets/icons/surrealdb-icon.png";
import surrealDbLightIcon from "@assets/icons/surrealdb-light-icon.png";
import sqlIcon from "@assets/icons/sql-icon.png";
import sqliteIcon from "@assets/icons/sqlite-icon.png";
import typescriptIcon from "@assets/icons/typescript.svg";
import uvIcon from "@assets/icons/uv-icon.svg";
import valkeyIcon from "@assets/icons/valkey-icon.png";

const icons = [
  {
    meta: activeMqIcon,
    alt: "ActiveMQ",
    search: "activemq",
    light: activeMqLightIcon,
  },
  { meta: adminerIcon, alt: "Adminer", search: "adminer" },
  { meta: awsIcon, alt: "AWS", search: "aws", light: awsLightIcon },
  { meta: azureAiFoundryIcon, alt: "Azure AI Foundry", search: "aifoundry" },
  {
    meta: azureAppconfigIcon,
    alt: "Azure App Configuration",
    search: "appconfig",
  },
  {
    meta: azureAppinsightsIcon,
    alt: "Azure Application Insights",
    search: "applicationinsights",
  },
  {
    meta: azureAppServicesIcon,
    alt: "Azure App Services",
    search: "appservice",
  },
  {
    meta: azureBlobpagestorageIcon,
    alt: "Azure Blob/Page Storage",
    search: "blob",
  },
  { meta: azureCacheredisIcon, alt: "Azure Cache for Redis", search: "redis" },
  {
    meta: azureContainerAppsEnvironmentsIcon,
    alt: "Azure Container Apps Environments",
    search: "container apps",
  },
  { meta: azureCosmosdbIcon, alt: "Azure Cosmos DB", search: "cosmos" },
  { meta: azureEventhubsIcon, alt: "Azure Event Hubs", search: "eventhubs" },
  {
    meta: azureFunctionappsIcon,
    alt: "Azure Function Apps",
    search: "functions",
  },
  { meta: azureIcon, alt: "Microsoft Azure", search: "azure" },
  { meta: azureKeyvaultIcon, alt: "Azure Key Vault", search: "keyvault" },
  {
    meta: azureLoganalyticsIcon,
    alt: "Azure Log Analytics",
    search: "operationalinsights",
  },
  { meta: azureOpenaiIcon, alt: "Azure OpenAI", search: "openai" },
  {
    meta: azurePostgresqlIcon,
    alt: "Azure Database for PostgreSQL",
    search: "postgresql",
  },
  { meta: azureSearchIcon, alt: "Azure Cognitive Search", search: "search" },
  { meta: azureServicebusIcon, alt: "Azure Service Bus", search: "servicebus" },
  { meta: azureSignalrIcon, alt: "Azure SignalR", search: "signalr" },
  { meta: azureSqlserverIcon, alt: "Azure SQL Server", search: "sql" },
  {
    meta: azureStoragecontainerIcon,
    alt: "Azure Storage Container",
    search: "storage",
  },
  { meta: azureStoragequeueIcon, alt: "Azure Storage Queue", search: "queue" },
  { meta: azureTableIcon, alt: "Azure Table Storage", search: "table" },
  { meta: azureWebpubsubIcon, alt: "Azure Web PubSub", search: "pubsub" },
  { meta: bunIcon, alt: "Bun", search: "bun" },
  {
    meta: dataApiBuilderIcon,
    alt: "Data API Builder",
    search: "dataapibuilder",
  },
  { meta: fastApiIcon, alt: "FastAPI", search: "python" },
  { meta: daprIcon, alt: "Dapr", search: "dapr", light: daprLightIcon },
  { meta: dbGateIcon, alt: "DbGate", search: "dbgate", light: dbGateLightIcon },
  { meta: denoIcon, alt: "Deno", search: "deno", light: denoLightIcon },
  { meta: devTunnelsIcon, alt: "Dev Tunnels", search: "devtunnels" },
  { meta: dockerIcon, alt: "Docker", search: "docker" },
  { meta: elasticIcon, alt: "Elasticsearch", search: "elasticsearch" },
  { meta: flagDIcon, alt: "flagd", search: "flagd", light: flagDLightIcon },
  { meta: garnetIcon, alt: "Garnet", search: "garnet" },
  { meta: goIcon, alt: "Go", search: "golang gofeature", light: goLightIcon },
  { meta: gitHubIcon, alt: "GitHub", search: "github", light: gitHubLightIcon },
  { meta: javaIcon, alt: "Java", search: "java" },
  { meta: javascriptIcon, alt: "JavaScript", search: "javascript" },
  { meta: k6Icon, alt: "k6", search: "k6" },
  { meta: keycloakIcon, alt: "Keycloak", search: "keycloak" },
  { meta: kubernetesIcon, alt: "Kubernetes", search: "kubernetes" },
  {
    meta: kurrentDbIcon,
    alt: "KurrentDB",
    search: "kurrentdb",
    light: kurrentDbLightIcon,
  },
  { meta: lavinMqIcon, alt: "LavinMQ", search: "lavinmq" },
  {
    meta: mailpitIcon,
    alt: "Mailpit",
    search: "mailpit",
    light: mailpitLightIcon,
  },
  { meta: mauiIcon, alt: ".NET MAUI", search: "maui" },
  { meta: meilisearchIcon, alt: "Meilisearch", search: "meilisearch" },
  {
    meta: mcpInspectorIcon,
    alt: "MCP Inspector",
    search: "mcpinspector",
    light: mcpInspectorLightIcon,
  },
  { meta: milvusIcon, alt: "Milvus Vector Database", search: "milvus" },
  { meta: minioIcon, alt: "MinIO", search: "minio" },
  { meta: mongodbIcon, alt: "MongoDB", search: "mongodb" },
  { meta: mysqlconnectorIcon, alt: "MySQL Connector", search: "mysql" },
  { meta: natsIcon, alt: "NATS Messaging", search: "nats" },
  { meta: ngrokIcon, alt: "ngrok", search: "ngrok", light: ngrokLightIcon },
  {
    meta: nodeJsIcon,
    alt: "Node.js",
    search: "nodejs",
    light: nodeJsLightIcon,
  },
  { meta: ollamaIcon, alt: "Ollama", search: "ollama" },
  { meta: oracleIcon, alt: "Oracle", search: "oracle" },
  { meta: openAiIcon, alt: "OpenAI", search: "openai", light: openAiLightIcon },
  {
    meta: papercutIcon,
    alt: "Papercut",
    search: "papercut",
    light: papercutLightIcon,
  },
  { meta: postgresqlIcon, alt: "PostgreSQL", search: "postgresql" },
  { meta: powershellIcon, alt: "PowerShell", search: "powershell" },
  { meta: pythonIcon, alt: "Python", search: "python" },
  { meta: qdrantIcon, alt: "Qdrant Vector Database", search: "qdrant" },
  { meta: rabbitmqIcon, alt: "RabbitMQ", search: "rabbitmq" },
  {
    meta: ravenDbIcon,
    alt: "RavenDB",
    search: "ravendb",
    light: ravenDbLightIcon,
  },
  { meta: redisIcon, alt: "Redis", search: "redis" },
  { meta: reactIcon, alt: "React", search: "nodejs" },
  { meta: rustIcon, alt: "Rust", search: "rust" },
  { meta: seqIcon, alt: "Seq Log Server", search: "seq" },
  { meta: sqlDatabaseProjectsIcon, alt: "SQL Database Projects", search: "sqlprojects" },
  {
    meta: surrealDbIcon,
    alt: "SurrealDB",
    search: "surrealdb",
    light: surrealDbLightIcon,
  },
  { meta: sqlIcon, alt: "SQL Database", search: "sql" },
  { meta: sqliteIcon, alt: "SQLite", search: "sqlite" },
  { meta: typescriptIcon, alt: "TypeScript", search: "typescript" },
  { meta: uvIcon, alt: "Uv", search: "python" },
  { meta: valkeyIcon, alt: "Valkey", search: "valkey" },
];

// Shuffle icons and split into 3 rows
import { shuffle } from "@utils/helpers.js";

const shuffledIcons = shuffle(icons);
const iconsPerRow = Math.ceil(shuffledIcons.length / 3);
const row1 = shuffledIcons.slice(0, iconsPerRow);
const row2 = shuffledIcons.slice(iconsPerRow, iconsPerRow * 2);
const row3 = shuffledIcons.slice(iconsPerRow * 2);

const infiniteIconsRow1 = [...row1, ...row1];
const infiniteIconsRow2 = [...row2, ...row2];
const infiniteIconsRow3 = [...row3, ...row3];
---

<div class="infinite-scroll-container">
  <!-- Row 1: Right to Left -->
  <div class="scroll-row scroll-rtl">
    <div class="scroll-content">
      {
        infiniteIconsRow1.map((icon) => (
          <a
            href={`/integrations/gallery/?search=${encodeURIComponent(icon.search)}`}
            class="img"
            data-tooltip-placement="top"
            title={Astro.locals.t("integrations.explore", {
              integration: icon.alt,
            })}
          >
            {icon.light ? (
              <>
                <Image
                  class:list={["icon", "dark"]}
                  src={icon.meta}
                  alt={icon.alt}
                />
                <Image
                  class:list={["icon", "light"]}
                  src={icon.light}
                  alt={icon.alt}
                />
              </>
            ) : (
              <Image class:list={["icon"]} src={icon.meta} alt={icon.alt} />
            )}
          </a>
        ))
      }
    </div>
  </div>

  <!-- Row 2: Left to Right -->
  <div class="scroll-row scroll-ltr">
    <div class="scroll-content">
      {
        infiniteIconsRow2.map((icon) => (
          <a
            href={`/integrations/gallery/?search=${encodeURIComponent(icon.search)}`}
            class="img"
            data-tooltip-placement="top"
            title={Astro.locals.t("integrations.explore", {
              integration: icon.alt,
            })}
          >
            {icon.light ? (
              <>
                <Image
                  class:list={["icon", "dark"]}
                  src={icon.meta}
                  alt={icon.alt}
                />
                <Image
                  class:list={["icon", "light"]}
                  src={icon.light}
                  alt={icon.alt}
                />
              </>
            ) : (
              <Image class:list={["icon"]} src={icon.meta} alt={icon.alt} />
            )}
          </a>
        ))
      }
    </div>
  </div>

  <!-- Row 3: Right to Left -->
  <div class="scroll-row scroll-rtl-slow">
    <div class="scroll-content">
      {
        infiniteIconsRow3.map((icon) => (
          <a
            href={`/integrations/gallery/?search=${encodeURIComponent(icon.search)}`}
            class="img"
            data-tooltip-placement="top"
            title={Astro.locals.t("integrations.explore", {
              integration: icon.alt,
            })}
          >
            {icon.light ? (
              <>
                <Image
                  class:list={["icon", "dark"]}
                  src={icon.meta}
                  alt={icon.alt}
                />
                <Image
                  class:list={["icon", "light"]}
                  src={icon.light}
                  alt={icon.alt}
                />
              </>
            ) : (
              <Image class:list={["icon"]} src={icon.meta} alt={icon.alt} />
            )}
          </a>
        ))
      }
    </div>
  </div>
</div>

<style>
  .infinite-scroll-container {
    width: 100%;
    overflow: hidden;
    padding: 1rem 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .scroll-row {
    display: flex;
    overflow: hidden;
    width: 100%;
    position: relative;
    mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
    -webkit-mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
  }

  .scroll-content {
    display: flex;
    gap: 1rem;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    will-change: transform;
  }

  /* Pause animation on hover for better UX */
  .scroll-row:hover .scroll-content {
    animation-play-state: paused;
  }

  /* Row 1: Right to Left */
  .scroll-rtl .scroll-content {
    animation: scroll-rtl 97s linear infinite;
  }

  /* Row 2: Left to Right */
  .scroll-ltr .scroll-content {
    animation: scroll-ltr 93s linear infinite;
  }

  /* Row 3: Right to Left */
  .scroll-rtl-slow .scroll-content {
    animation: scroll-rtl 87s linear infinite;
  }

  @keyframes scroll-rtl {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  @keyframes scroll-ltr {
    0% {
      transform: translateX(-50%);
    }
    100% {
      transform: translateX(0);
    }
  }

  .img {
    width: 7rem;
    height: 7rem;
    min-width: 7rem;
    min-height: 7rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    background-color: var(--sl-color-bg);
    border: 1px solid var(--sl-color-gray-4);
    border-radius: 0.5rem;
    overflow: hidden;
    margin-top: initial;
  }

  .img img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .img * {
    margin-top: initial;
  }

  /* Theme-aware icon switching when a light variant exists */
  a.img img.icon.light {
    display: none;
  }
  a.img img.icon.dark {
    display: block;
  }
  :global([data-theme="light"]) a.img img.icon.light {
    display: block;
  }
  :global([data-theme="light"]) a.img img.icon.dark {
    display: none;
  }

  /* Responsive adjustments */
  @media screen and (max-width: 768px) {
    .img {
      width: 5rem;
      height: 5rem;
      min-width: 5rem;
      min-height: 5rem;
    }

    .scroll-content {
      gap: 0.75rem;
    }
  }

  @media screen and (min-width: 320px) and (max-width: 767px) {
    .img {
      width: 4rem;
      height: 4rem;
      min-width: 4rem;
      min-height: 4rem;
    }

    .scroll-content {
      gap: 0.5rem;
    }
  }
</style>
