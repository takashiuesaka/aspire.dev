---
import { Image } from 'astro:assets';

import go from '@assets/icons/go.svg';
import python from '@assets/icons/python.svg';
import javascript from '@assets/icons/javascript.svg';
import typescript from '@assets/icons/typescript.svg';
import java from '@assets/icons/java.svg';
import csharp from '@assets/icons/csharp.svg';

const languages = [
  { name: 'Go', icon: go, search: 'golang gofeature' },
  { name: 'Python', icon: python, search: 'python' },
  { name: 'JavaScript', icon: javascript, search: 'javascript nodejs' },
  { name: 'TypeScript', icon: typescript, search: 'javascript nodejs' },
  { name: 'Java', icon: java, search: 'java' },
  { name: 'C#', icon: csharp, search: '' },
];

const getSearchParam = (lang: { name: string; search?: string; icon?: any }) => {
  return lang.search !== undefined ? lang.search : encodeURIComponent(lang.name.toLowerCase());
};
---

<section class="languages-supported">
  <div class="languages-grid" data-languages-grid>
    {
      languages.map((lang) => (
        <a
          href={`/integrations/gallery/?search=${getSearchParam(lang)}`}
          class="language-card"
          data-lang-name={lang.name}
          aria-label={`${Astro.locals.t('integrations.explore', { integration: lang.name })}`}
          title={`${Astro.locals.t('integrations.explore', { integration: lang.name })}`}
          data-tooltip-placement="top"
        >
          {'icon' in lang && lang.icon ? (
            <Image src={lang.icon} alt={lang.name} class:list={['icon']} width="64" height="64" />
          ) : (
            <div class="icon-placeholder" aria-hidden="true" />
          )}
          <span>{lang.name}</span>
        </a>
      ))
    }
    <a
      href="/integrations/gallery/?search="
      class="language-card"
      data-lang-name="And more..."
      aria-label={`${Astro.locals.t('integrations.explore', { integration: 'more integrations' })}`}
      title={`${Astro.locals.t('integrations.explore', { integration: 'more integrations' })}`}
      data-tooltip-placement="top"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="64"
        height="64"
        viewBox="0 0 24 24"
        class="icon"
      >
        <path
          fill="none"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="1.5"
          d="M8 12h4m4 0h-4m0 0V8m0 4v4m0 6c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10"
        ></path>
      </svg>
      <span>And more...</span>
    </a>
  </div>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      const grid = document.querySelector('[data-languages-grid]');
      if (!grid) return;

      const cards = Array.from(grid.querySelectorAll('.language-card'));
      if (cards.length <= 1) return;

      // Keep "And more..." card (last one) separate
      const moreCard = cards[cards.length - 1];
      const languageCards = cards.slice(0, -1);

      // Shuffle language cards
      for (let i = languageCards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        const cardI = languageCards[i];
        const cardJ = languageCards[j];
        if (cardI && cardJ) {
          [languageCards[i], languageCards[j]] = [cardJ, cardI];
        }
      }

      // Re-append cards in shuffled order, with "And more..." last
      languageCards.forEach((card) => grid.appendChild(card));
      grid.appendChild(moreCard);
    });
  </script>

  <style>
    .icon-placeholder {
      height: calc(4rem + 0.5rem);
    }

    .languages-supported {
      text-align: center;
    }

    .languages-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 0.5rem;
      max-width: 100%;
    }

    .language-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.2s;
      border-radius: 0.5rem;
      padding: 1rem 1.5rem;
      border: 1px solid var(--sl-color-gray-4);
      background: var(--sl-color-gray-6);
      /* Fixed width to keep all cards identical size */
      flex: 0 0 8rem;
      width: 8rem; /* ensure consistency even if flex changes */
      box-sizing: border-box;
      margin-top: initial;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }

    .language-card:hover {
      transform: scale(1.1);
    }

    .language-card:focus {
      transform: scale(1.1);
      outline: 2px solid var(--sl-color-text-accent);
      outline-offset: 2px;
    }

    .language-card:focus-visible {
      transform: scale(1.1);
      outline: 2px solid var(--sl-color-text-accent);
      outline-offset: 2px;
    }

    .language-card img {
      width: 4rem;
      height: 4rem;
      margin-bottom: 0.5rem;
    }

    .language-card svg {
      width: 4rem;
      height: 4rem;
      margin-bottom: 0.5rem;
      color: var(--sl-color-text-accent);
    }

    .language-card span {
      font-size: 1rem;
      font-weight: 500;
      white-space: nowrap;
    }

    @media (max-width: 600px) {
      .languages-grid {
        justify-content: space-evenly;
      }
      .language-card {
        flex: 0 0 7rem;
        width: 7rem;
        margin-top: 0.5rem;
        padding: 0.75rem 1rem;
      }
      .language-card img {
        width: 3.5rem;
        height: 3.5rem;
      }
      .language-card svg {
        width: 3.5rem;
        height: 3.5rem;
      }
      .language-card span {
        font-size: 0.9rem;
      }
    }
  </style>
</section>
