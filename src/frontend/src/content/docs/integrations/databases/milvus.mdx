---
title: Milvus integration
description: Learn how to use the Milvus integration, which includes both hosting and client integrations.
---

import { Aside } from '@astrojs/starlight/components';
import InstallPackage from '@components/InstallPackage.astro';
import InstallDotNetPackage from '@components/InstallDotNetPackage.astro';
import { Image } from 'astro:assets';
import milvusIcon from '@assets/icons/milvus-icon.png';

<Image
  src={milvusIcon}
  alt="Milvus logo"
  width={100}
  height={100}
  class:list={'float-inline-left icon'}
  data-zoom-off
/>

[Milvus](https://milvus.io/) is an open-source vector database system that efficiently stores, indexes, and searches large-scale vector data. It's commonly used in machine learning, artificial intelligence, and data science applications.

Vector data encodes information as mathematical vectors, which are arrays of numbers or coordinates. Machine learning and AI systems often use vectors to represent unstructured objects like images, text, audio, or video.

## Hosting integration

The Milvus database hosting integration models the server as the `MilvusServerResource` type and the database as the `MilvusDatabaseResource` type. To access these types and APIs, add the [ðŸ“¦ Aspire.Hosting.Milvus](https://www.nuget.org/packages/Aspire.Hosting.Milvus) NuGet package in your AppHost project:

<InstallPackage packageName="Aspire.Hosting.Milvus" />

### Add Milvus server and database resources

In your AppHost project, call `AddMilvus` to add and return a Milvus resource builder. Chain a call to the returned resource builder to `AddDatabase`, to add a Milvus database resource:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var milvus = builder.AddMilvus("milvus")
                    .WithLifetime(ContainerLifetime.Persistent);

var milvusdb = milvus.AddDatabase("milvusdb");

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(milvusdb)
                       .WaitFor(milvusdb);
```

<Aside type="note">
  The Milvus container can be slow to start, so it's best to use a _persistent_
  lifetime to avoid unnecessary restarts. For more information, see [Container
  resource
  lifetime](/architecture/resource-model/#built-in-resources-and-lifecycle).
</Aside>

The `WithReference` method configures a connection in the `ExampleProject` named `milvusdb`.

<Aside type="tip">
  If you'd rather connect to an existing Milvus server, call
  `AddConnectionString` instead. For more information, see [Reference existing
  resources](/get-started/resources/).
</Aside>

### Handling credentials and parameters

The Milvus resource includes default credentials with a `username` of `root` and the password `Milvus`. To change the default password in the container, pass an `apiKey` parameter:

```csharp
var apiKey = builder.AddParameter("apiKey", secret: true);

var milvus = builder.AddMilvus("milvus", apiKey);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(milvus);
```

For more information, see [External parameters](/get-started/resources/).

### Add a Milvus resource with a data volume

To add a data volume to the Milvus service resource, call the `WithDataVolume` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var milvus = builder.AddMilvus("milvus")
                    .WithDataVolume();

var milvusdb = milvus.AddDatabase("milvusdb");

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(milvusdb)
                       .WaitFor(milvusdb);
```

The data volume is used to persist the Milvus data outside the lifecycle of its container. The data volume is mounted at the `/var/lib/milvus` path.

### Add a Milvus resource with a data bind mount

To add a data bind mount to the Milvus resource, call the `WithDataBindMount` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var milvus = builder.AddMilvus("milvus")
                    .WithDataBindMount(source: @"C:\Milvus\Data");

var milvusdb = milvus.AddDatabase("milvusdb");

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(milvusdb)
                       .WaitFor(milvusdb);
```

<Aside>
  Data bind mounts have limited functionality compared to volumes, and when you
  use a bind mount, a file or directory on the host machine is mounted into a
  container.
</Aside>

### Create an Attu resource

[Attu](https://zilliz.com/attu) is a graphical user interface (GUI) and management tool designed to interact with Milvus and its databases. To use Attu, call the `WithAttu` extension method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var milvus = builder.AddMilvus("milvus")
                    .WithAttu()
                    .WithLifetime(ContainerLifetime.Persistent);

var milvusdb = milvus.AddDatabase("milvusdb");

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(milvusdb)
                       .WaitFor(milvusdb);
```

When you debug the Aspire solution, you'll see an Attu container listed in the resources. Select the resource's endpoint to open the GUI.

### Connection properties

When you reference a Milvus resource using `WithReference`, the following connection properties are made available to the consuming project:

#### Milvus server

The Milvus server resource exposes the following connection properties:

| Property Name | Description                                                   |
| ------------- | ------------------------------------------------------------- |
| `Host`        | The hostname or IP address of the Milvus server               |
| `Port`        | The gRPC port exposed by the Milvus server                    |
| `Token`       | The authentication token, with the format `root:{ApiKey}`     |
| `Uri`         | The gRPC endpoint URI, with the format `http://{Host}:{Port}` |

**Example connection strings:**

```
Uri: http://localhost:19530
Token: root:Milvus
```

#### Milvus database

The Milvus database resource combines the server properties above and adds the following connection property:

| Property Name | Description              |
| ------------- | ------------------------ |
| `Database`    | The Milvus database name |

<Aside type="note">
  Aspire exposes each property as an environment variable named
  `[RESOURCE]_[PROPERTY]`. For instance, the `Uri` property of a resource called
  `vectordb` becomes `VECTORDB_URI`.
</Aside>

## Client integration

<Aside type="caution">The client integration is currently in preview.</Aside>

To get started with the Aspire Milvus client integration, install the [ðŸ“¦ Aspire.Milvus.Client](https://www.nuget.org/packages/Aspire.Milvus.Client) NuGet package in the client-consuming project:

<InstallDotNetPackage packageName="Aspire.Milvus.Client" />

### Add a Milvus client

In the `Program.cs` file, call the `AddMilvusClient` extension method to register a `MilvusClient`:

```csharp
builder.AddMilvusClient("milvusdb");
```

<Aside type="tip">
  The `connectionName` parameter must match the name used when adding the Milvus
  database resource in the AppHost project.
</Aside>

You can then retrieve the `MilvusClient` instance using dependency injection:

```csharp
public class ExampleService(MilvusClient client)
{
    // Use the Milvus Client...
}
```

### Add a keyed Milvus client

There might be situations where you want to register multiple `MilvusClient` instances. To register keyed Milvus clients, call the `AddKeyedMilvusClient` method:

```csharp
builder.AddKeyedMilvusClient(name: "mainDb");
builder.AddKeyedMilvusClient(name: "loggingDb");
```

Then retrieve the instances:

```csharp
public class ExampleService(
    [FromKeyedServices("mainDb")] MilvusClient mainDbClient,
    [FromKeyedServices("loggingDb")] MilvusClient loggingDbClient)
{
    // Use clients...
}
```

### Configuration

#### Use a connection string

When using a connection string from the `ConnectionStrings` configuration section:

```csharp
builder.AddMilvusClient("milvus");
```

Then the connection string will be retrieved:

```json
{
  "ConnectionStrings": {
    "milvus": "Endpoint=http://localhost:19530/;Key=root:Non-default-P@ssw0rd"
  }
}
```

#### Use configuration providers

The Milvus client integration supports `Microsoft.Extensions.Configuration`. Example `appsettings.json`:

```json
{
  "Aspire": {
    "Milvus": {
      "Client": {
        "Endpoint": "http://localhost:19530/",
        "Database": "milvusdb",
        "Key": "root:Non-default-P@ssw0rd",
        "DisableHealthChecks": false
      }
    }
  }
}
```

#### Use inline delegates

You can pass the delegate to set up options inline:

```csharp
builder.AddMilvusClient(
    "milvus",
    static settings => settings.Key = "root:Non-default-P@ssw0rd");
```

### Client integration health checks

By default, Aspire integrations enable health checks. The Milvus database integration adds a health check when `DisableHealthChecks` is `false`, which attempts to connect to the Milvus server.

### Observability and telemetry

#### Logging

The Milvus integration uses the `Milvus.Client` log category.

#### Tracing and Metrics

The Milvus integration doesn't currently emit tracing activities or metrics because they are not supported by the `Milvus.Client` library.
