---
title: KurrentDB integration
description: Learn how to use the KurrentDB hosting and client integration to run the KurrentDB container and access it via the KurrentDB client.
---

import { Aside } from '@astrojs/starlight/components';
import { Badge } from '@astrojs/starlight/components';
import InstallPackage from '@components/InstallPackage.astro';
import InstallDotNetPackage from '@components/InstallDotNetPackage.astro';
import ThemeImage from '@components/ThemeImage.astro';
import kurrentIcon from '@assets/icons/kurrent-icon.png';
import kurrentLightIcon from '@assets/icons/kurrent-light-icon.png';

<Badge text="â­ Community Toolkit" variant="tip" size="large" />

<ThemeImage
  light={kurrentLightIcon}
  dark={kurrentIcon}
  alt="KurrentDB logo"
  width={100}
  height={100}
  zoomable={false}
  classOverride="float-inline-left icon"
/>

[KurrentDB](https://www.kurrent.io/) is an event store database designed for Event Sourcing, offering high availability and reliability for storing events. The Aspire KurrentDB integration enables you to connect to existing KurrentDB instances or create new instances from Aspire using the KurrentDB container image.

## Hosting integration

To run the KurrentDB container, install the [ðŸ“¦ CommunityToolkit.Aspire.Hosting.KurrentDB](https://nuget.org/packages/CommunityToolkit.Aspire.Hosting.KurrentDB) NuGet package in the AppHost project.

<InstallPackage packageName="CommunityToolkit.Aspire.Hosting.KurrentDB" />

### Add KurrentDB resource

In the AppHost project, register and consume the KurrentDB integration using the `AddKurrentDB` extension method to add the KurrentDB container to the application builder.

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var kurrentdb = builder.AddKurrentDB("kurrentdb");

builder.AddProject<Projects.ExampleProject>()
       .WithReference(kurrentdb);

// After adding all resources, run the app...
```

### Add KurrentDB resource with data volume

To add a data volume to the KurrentDB resource, call the `WithDataVolume` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var kurrentdb = builder.AddKurrentDB("kurrentdb")
                       .WithDataVolume();

builder.AddProject<Projects.ExampleProject>()
       .WithReference(kurrentdb);

// After adding all resources, run the app...
```

The data volume is used to persist the KurrentDB data outside the lifecycle of its container. The data volume is mounted at the `/var/lib/kurrentdb` path in the KurrentDB container.

### Add KurrentDB resource with data bind mount

To add a data bind mount to the KurrentDB resource, call the `WithDataBindMount` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var kurrentdb = builder.AddKurrentDB("kurrentdb")
                       .WithDataBindMount(source: @"C:\KurrentDB\Data");

builder.AddProject<Projects.ExampleProject>()
       .WithReference(kurrentdb);

// After adding all resources, run the app...
```

<Aside>
  Data bind mounts have limited functionality compared to volumes, and when you
  use a bind mount, a file or directory on the host machine is mounted into a
  container.
</Aside>

### Hosting integration health checks

The KurrentDB hosting integration automatically adds a health check for the KurrentDB resource. The health check verifies that the KurrentDB instance is running and that a connection can be established to it.

## Client integration

To get started with the Aspire KurrentDB client integration, install the [ðŸ“¦ CommunityToolkit.Aspire.KurrentDB](https://nuget.org/packages/CommunityToolkit.Aspire.KurrentDB) NuGet package in the client-consuming project:

<InstallDotNetPackage packageName="CommunityToolkit.Aspire.KurrentDB" />

### Add KurrentDB client

In the `Program.cs` file of your client-consuming project, call the `AddKurrentDBClient` extension to register an `KurrentDBClient` for use via the dependency injection container.

```csharp
builder.AddKurrentDBClient(connectionName: "kurrentdb");
```

<Aside type="tip">
  The `connectionName` parameter must match the name used when adding the
  KurrentDB resource in the AppHost project.
</Aside>

You can then retrieve the `KurrentDBClient` instance using dependency injection. For example, to retrieve the client from a service:

```csharp
public class ExampleService(KurrentDBClient client)
{
    // Use client...
}
```

### Add keyed KurrentDB client

There might be situations where you want to register multiple `KurrentDBClient` instances with different connection names. To register keyed KurrentDB clients, call the `AddKeyedKurrentDBClient` method:

```csharp
builder.AddKeyedKurrentDBClient(name: "events");
builder.AddKeyedKurrentDBClient(name: "audit");
```

Then retrieve the instances using dependency injection:

```csharp
public class ExampleService(
    [FromKeyedServices("events")] KurrentDBClient eventsClient,
    [FromKeyedServices("audit")] KurrentDBClient auditClient)
{
    // Use clients...
}
```

For more information on keyed services, see [.NET dependency injection: Keyed services](https://learn.microsoft.com/dotnet/core/extensions/dependency-injection#keyed-services).

### Configuration

The KurrentDB client integration provides multiple configuration approaches and options to meet the requirements and conventions of your project.

#### Use a connection string

When using a connection string from the `ConnectionStrings` configuration section, you can provide the name of the connection string when calling `AddKurrentDBClient`:

```csharp
builder.AddKurrentDBClient("kurrentdb");
```

Then the connection string will be retrieved from the `ConnectionStrings` configuration section:

```json
{
  "ConnectionStrings": {
    "kurrentdb": "kurrentdb://localhost:22113?tls=false"
  }
}
```

#### Use configuration providers

The KurrentDB client integration supports `Microsoft.Extensions.Configuration`. It loads the `KurrentDBSettings` from configuration using the `Aspire:KurrentDB:Client` key. Example `appsettings.json`:

```json
{
  "Aspire": {
    "KurrentDB": {
      "Client": {
        "ConnectionString": "kurrentdb://localhost:22113?tls=false",
        "DisableHealthChecks": false,
        "DisableTracing": false
      }
    }
  }
}
```

#### Use inline delegates

You can pass the delegate to set up options inline:

```csharp
builder.AddKurrentDBClient(
    "kurrentdb",
    static settings => settings.DisableHealthChecks = true);
```

### Client integration health checks

By default, Aspire integrations enable health checks for all services. The KurrentDB integration adds a health check that verifies the KurrentDB instance is reachable and can execute commands.

### Observability and telemetry

#### Logging

The KurrentDB integration uses the following log categories:

- `Aspire.KurrentDB`

#### Tracing

The KurrentDB integration emits tracing activities using OpenTelemetry when tracing is not disabled.

## See also

- [KurrentDB](https://www.kurrent.io/)
- [KurrentDB .NET Client](https://github.com/kurrent-io/KurrentDB-Client-Dotnet)
- [Aspire Community Toolkit GitHub repo](https://github.com/CommunityToolkit/Aspire)
