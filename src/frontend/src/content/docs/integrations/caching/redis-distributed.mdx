---
title: Redis Distributed Caching
description: Learn how to use the Redis distributed caching integration to register an IDistributedCache provider backed by Redis.
---

import { Aside } from '@astrojs/starlight/components';
import InstallDotNetPackage from '@components/InstallDotNetPackage.astro';
import { Image } from 'astro:assets';
import redisIcon from '@assets/icons/redis-icon.png';

<Image
  src={redisIcon}
  alt="Redis logo"
  width={80}
  height={80}
  class:list={'float-inline-left icon'}
  data-zoom-off
/>

The [RedisÂ®](#registered-trademark) distributed caching integration is used to register an [IDistributedCache](https://learn.microsoft.com/dotnet/api/microsoft.extensions.caching.distributed.idistributedcache) provider backed by a [Redis](https://redis.io/) server with the [`docker.io/library/redis` container image](https://hub.docker.com/_/redis/).

## Hosting integration

import InstallPackage from '@components/InstallPackage.astro';

The Redis hosting integration models a Redis resource as the `RedisResource` type. To access this type and APIs, add the [ðŸ“¦ Aspire.Hosting.Redis](https://www.nuget.org/packages/Aspire.Hosting.Redis) NuGet package in your AppHost project:

<InstallPackage packageName="Aspire.Hosting.Redis" />

### Add Redis resource

In your AppHost project, call `AddRedis` on the builder instance to add a Redis resource:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddRedis("cache");

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

When Aspire adds a container image to the AppHost, it creates a new Redis instance on your local machine.

<Aside type="tip">
  If you'd rather connect to an existing Redis instance, call `AsExisting`
  instead.
</Aside>

### Add Redis resource with data volume

To add a data volume to the Redis resource, call the `WithDataVolume` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddRedis("cache")
                   .WithDataVolume(isReadOnly: false);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

The data volume is used to persist the Redis data outside the lifecycle of its container. The data volume is mounted at the `/data` path in the Redis container.

### Add Redis resource with persistence

To add persistence to the Redis resource, call the `WithPersistence` method with either the data volume or data bind mount:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddRedis("cache")
                   .WithDataVolume()
                   .WithPersistence(
                       interval: TimeSpan.FromMinutes(5),
                       keysChangedThreshold: 100);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

The preceding code adds persistence to the Redis resource by taking snapshots of the Redis data at a specified interval and threshold.

For more Redis hosting integration options, see the main [Redis integration](/integrations/caching/redis/) page.

## Client integration

To get started with the Redis distributed caching integration, install the [ðŸ“¦ Aspire.StackExchange.Redis.DistributedCaching](https://www.nuget.org/packages/Aspire.StackExchange.Redis.DistributedCaching) NuGet package:

<InstallDotNetPackage packageName="Aspire.StackExchange.Redis.DistributedCaching" />

### Add Redis distributed cache

In the `Program.cs` file of your client-consuming project, call the `AddRedisDistributedCache` extension to register the required services for distributed caching:

```csharp
builder.AddRedisDistributedCache(connectionName: "cache");
```

<Aside type="tip">
  The `connectionName` parameter must match the name used when adding the Redis
  resource in the AppHost project.
</Aside>

You can then retrieve the `IDistributedCache` instance using dependency injection:

```csharp
public class ExampleService(IDistributedCache cache)
{
    // Use cache...
}
```

### Add keyed Redis distributed cache

Due to its limitations, you cannot register multiple `IDistributedCache` instances simultaneously. However, there may be scenarios where you need to register multiple Redis clients. To register a keyed Redis client for `IDistributedCache`, call the `AddKeyedRedisDistributedCache` method:

```csharp
builder.AddKeyedRedisClient(name: "chat");
builder.AddKeyedRedisDistributedCache(name: "product");
```

Then retrieve the instances:

```csharp
public class ExampleService(
    [FromKeyedServices("chat")] IConnectionMultiplexer chatConnectionMux,
    IDistributedCache productCache)
{
    // Use product cache...
}
```

### Configuration

#### Use a connection string

When using a connection string from the `ConnectionStrings` configuration section:

```csharp
builder.AddRedisDistributedCache("cache");
```

Then the connection string will be retrieved:

```json
{
  "ConnectionStrings": {
    "cache": "localhost:6379"
  }
}
```

#### Use configuration providers

The Redis distributed caching integration supports `Microsoft.Extensions.Configuration`. Example `appsettings.json`:

```json
{
  "Aspire": {
    "StackExchange": {
      "Redis": {
        "DistributedCaching": {
          "ConnectionString": "localhost:6379",
          "DisableHealthChecks": false,
          "DisableTracing": false
        }
      }
    }
  }
}
```

#### Use inline delegates

You can pass the delegate to set up options inline:

```csharp
builder.AddRedisDistributedCache(
    "cache",
    settings => settings.DisableTracing = true);
```

You can also configure the [ConfigurationOptions](https://stackexchange.github.io/StackExchange.Redis/Configuration.html#configuration-options):

```csharp
builder.AddRedisDistributedCache(
    "cache",
    null,
    static options => options.ConnectTimeout = 3_000);
```

### Client integration health checks

By default, Aspire integrations enable health checks. The Redis distributed caching integration adds a health check that verifies the Redis instance is reachable.

### Observability and telemetry

#### Logging

The Redis distributed caching integration uses standard .NET logging.

#### Tracing

The integration emits tracing activities using OpenTelemetry.

#### Metrics

The integration emits metrics using OpenTelemetry.

:::tip[Registered trademark]{icon="information"}

<span id="registered-trademark"></span>
Redis is a registered trademark of Redis Ltd. Any rights therein are reserved to
Redis Ltd. Any use by Microsoft is for referential purposes only and does not
indicate any sponsorship, endorsement or affiliation between Redis and
Microsoft. :::
