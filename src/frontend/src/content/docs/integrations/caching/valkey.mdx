---
title: Valkey integration
description: Learn how to use the Valkey integration, a Redis fork that is a high-performance key/value datastore.
next: false
---

import InstallPackage from '@components/InstallPackage.astro';
import InstallDotNetPackage from '@components/InstallDotNetPackage.astro';
import { Aside } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import valkeyIcon from '@assets/icons/valkey-icon.png';

<Image
  src={valkeyIcon}
  alt="Valkey logo"
  width={100}
  height={100}
  class:list={'float-inline-left icon'}
  data-zoom-off
/>

[Valkey](https://valkey.io/) is a Redis fork and complies with the Redis serialization protocol (RESP). It's a high-performance key/value datastore that supports a variety of workloads such as caching, message queues, and can act as a primary database. The Valkey integration enables you to connect to existing Valkey instances, or create new instances from Aspire with the `docker.io/valkey/valkey` container image.

## Hosting integration

The Valkey hosting integration models a Valkey resource as the `ValkeyResource` type. To access this type and APIs, add the [ðŸ“¦ Aspire.Hosting.Valkey](https://www.nuget.org/packages/Aspire.Hosting.Valkey) NuGet package in your AppHost project:

<InstallPackage packageName="Aspire.Hosting.Valkey" />

### Add Valkey resource

In your AppHost project, call `AddValkey` on the builder instance to add a Valkey resource:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddValkey("cache");

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

When Aspire adds a container image to the AppHost, it creates a new Valkey instance on your local machine.

<Aside type="tip">
  If you'd rather connect to an existing Valkey instance, call `AsExisting`
  instead.
</Aside>

### Add Valkey resource with data volume

To add a data volume to the Valkey resource, call the `WithDataVolume` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddValkey("cache")
                   .WithDataVolume(isReadOnly: false);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

The data volume is used to persist the Valkey data outside the lifecycle of its container. The data volume is mounted at the `/data` path in the Valkey container.

### Add Valkey resource with data bind mount

To add a data bind mount to the Valkey resource, call the `WithDataBindMount` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddValkey("cache")
                   .WithDataBindMount(
                       source: @"C:\Valkey\Data",
                       isReadOnly: false);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

<Aside>
  Data bind mounts have limited functionality compared to volumes, and when you
  use a bind mount, a file or directory on the host machine is mounted into a
  container.
</Aside>

### Add Valkey resource with persistence

To add persistence to the Valkey resource, call the `WithPersistence` method with either the data volume or data bind mount:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddValkey("cache")
                   .WithDataVolume()
                   .WithPersistence(
                       interval: TimeSpan.FromMinutes(5),
                       keysChangedThreshold: 100);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

The preceding code adds persistence to the Valkey resource by taking snapshots of the data at a specified interval and threshold.

### Connection properties

When you reference a Valkey resource using `WithReference`, the following connection properties are made available to the consuming project:

#### Valkey

The Valkey resource exposes the following connection properties:

| Property Name | Description                                                              |
| ------------- | ------------------------------------------------------------------------ |
| `Host`        | The hostname or IP address of the Valkey server                          |
| `Port`        | The port number the Valkey server is listening on                        |
| `Password`    | The password for authentication                                          |
| `Uri`         | The connection URI, with the format `valkey://:{Password}@{Host}:{Port}` |

**Example connection string:**

```
Uri: valkey://:p%40ssw0rd1@localhost:6379
```

<Aside type="note">
  Aspire exposes each property as an environment variable named
  `[RESOURCE]_[PROPERTY]`. For instance, the `Uri` property of a resource called
  `cache` becomes `CACHE_URI`.
</Aside>

### Hosting integration health checks

The Valkey hosting integration automatically adds a health check for the Valkey resource. The health check verifies that the Valkey instance is running and that a connection can be established to it.

## Client integration

Valkey is Redis-compatible, so you use the same Redis client packages. To get started, install the [ðŸ“¦ Aspire.StackExchange.Redis](https://www.nuget.org/packages/Aspire.StackExchange.Redis) NuGet package:

<InstallDotNetPackage packageName="Aspire.StackExchange.Redis" />

### Add Valkey client

In the `Program.cs` file of your client-consuming project, call the `AddRedisClient` extension method to register an `IConnectionMultiplexer`:

```csharp
builder.AddRedisClient(connectionName: "cache");
```

<Aside type="tip">
  The `connectionName` parameter must match the name used when adding the Valkey
  resource in the AppHost project.
</Aside>

You can then retrieve the `IConnectionMultiplexer` instance using dependency injection:

```csharp
public class ExampleService(IConnectionMultiplexer connectionMux)
{
    // Use connection multiplexer...
}
```

### Configuration and other client features

Since Valkey is Redis-compatible, all Redis client configuration, keyed services, health checks, and observability features work the same way. See the [Redis integration](/integrations/caching/redis/) page for complete client integration documentation.

### Distributed caching and output caching

Valkey also supports Redis distributed caching and output caching. Install the respective packages:

- For distributed caching: [ðŸ“¦ Aspire.StackExchange.Redis.DistributedCaching](https://www.nuget.org/packages/Aspire.StackExchange.Redis.DistributedCaching)
- For output caching: [ðŸ“¦ Aspire.StackExchange.Redis.OutputCaching](https://www.nuget.org/packages/Aspire.StackExchange.Redis.OutputCaching)

See [Redis Distributed Caching](/integrations/caching/redis-distributed/) and [Redis Output Caching](/integrations/caching/redis-output/) for usage details.
